<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="js/main.js"></script>
    <title>Rankine Cycle Design Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
        }

        .container {
            display: flex;
            flex: 1;
            gap: 20px;
        }

        #designCanvas {
            border: 1px solid #ccc;
            flex: 3;
            position: relative;
            overflow: hidden;
            background-color: #f9f9f9;
        }

        #propertiesPanel {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
        }


        /* 设备容器基础样式 */
        .device {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #0083a9;
            background-color: white;
            border: 2px solid #0083a9;
            overflow: visible;
            /* 确保内容不会裁剪 */
            z-index: 10;
        }

        .device.selected {
            outline: 2px dashed blue;
        }


        /* 端口基础样式 */
        .port {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #0083a9;
            cursor: pointer;
            z-index: 20;
            /* 确保端口在设备上方 */
        }

        .connection {
            position: absolute;
            background-color: #0083a9;
            height: 2px;
            transform-origin: 0 0;
            z-index: 5;
        }

        .connection-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 6px solid #0083a9;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            transform-origin: center;
        }

        #connectionModeBtn.active {
            background-color: #0083a9;
            color: white;
        }

        .port-highlight {
            box-shadow: 0 0 0 3px yellow;
        }

        .hidden {
            display: none;
        }

        #fileInput {
            position: absolute;
            width: 0;
            height: 0;
            overflow: hidden;
            opacity: 0;
        }
    </style>
</head>

<body>
    <h1>Rankine Cycle Design Tool</h1>

    <div class="toolbar">
        <button id="addTurbine">Add Turbine (Extraction)</button>
        <button id="addSimpleTurbine">Add Turbine (Simple)</button>
        <button id="addCondenser">Add Condenser</button>
        <button id="addPump">Add Pump</button>
        <button id="addBoiler">Add Boiler</button>
        <button id="addHeater">Add Feedwater Heater</button>
        <button id="addReheatBoiler">Add Reheat Boiler</button>
        <button id="connectionModeBtn">Connection Mode</button>
        <button id="saveDesign">Save Design</button>
        <button id="loadDesign">Load Design</button>
        <input type="file" id="fileInput" class="hidden" accept=".json">
        <button id="deleteSelected">Delete Selected</button>
    </div>

    <div class="container">
        <div id="designCanvas"></div>
        <div id="propertiesPanel">
            <h3>Properties</h3>
            <div id="noSelectionMessage">Select a device to edit its properties</div>
            <div id="propertyForm" class="hidden">
                <!-- 通用属性 -->
                <div class="property-row">
                    <label for="deviceType">Device Type:</label>
                    <select id="deviceType" disabled>
                        <!-- 选项由JavaScript动态生成 -->
                    </select>
                </div>
                <div id="extractionTurbineProperties">
                    <div class="property-row">
                        <label for="p_out">Outlet Pressure (p_out):</label>
                        <input type="number" id="p_out" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="p_ex">Exlet Pressure (p_ex):</label>
                        <input type="number" id="p_ex" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="ef">Efficiency (ef):</label>
                        <input type="number" id="ef" min="0" max="100" step="1">
                    </div>
                </div>
                <div id="simpleTurbineProperties" class="hidden">
                    <div class="property-row">
                        <label for="simple_p_out">Outlet Pressure (p_out):</label>
                        <input type="number" id="simple_p_out" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="simple_ef">Efficiency (ef):</label>
                        <input type="number" id="simple_ef" min="0" max="100" step="1">
                    </div>
                </div>
                <div id="condenserProperties" class="hidden">
                    <div class="property-row">
                        <label for="condenser_p_out">Outlet Pressure (p_out):</label>
                        <input type="number" id="condenser_p_out" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="x_out">Dryness (x_out):</label>
                        <input type="number" id="x_out" min="0" max="1" step="0.1">
                    </div>
                </div>
                <div id="pumpProperties" class="hidden">
                    <div class="property-row">
                        <label for="pump_p_out">Outlet Pressure (p_out):</label>
                        <input type="number" id="pump_p_out" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="pump_ef">Efficiency (ef):</label>
                        <input type="number" id="pump_ef" min="0" max="100" step="1">
                    </div>
                </div>
                <div id="boilerProperties" class="hidden">
                    <div class="property-row">
                        <label for="boiler_p_out">Outlet Pressure (p_out):</label>
                        <input type="number" id="boiler_p_out" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="boiler_x_out">Dryness (x_out):</label>
                        <input type="number" id="boiler_x_out" min="0" max="1" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="t_out">Temperature (t_out):</label>
                        <input type="number" id="t_out" step="1">
                    </div>
                    <div class="property-row">
                        <label for="x_flow_out">Mass Flow (x_flow_out):</label>
                        <input type="number" id="x_flow_out" step="0.1">
                    </div>
                </div>
                <div id="heaterProperties" class="hidden">
                    <div class="property-row">
                        <label for="heater_p_out">Outlet Pressure (p_out):</label>
                        <input type="number" id="heater_p_out" step="0.1">
                    </div>
                    <div class="property-row">
                        <label for="heater_x_out">Dryness (x_out):</label>
                        <input type="number" id="heater_x_out" min="0" max="1" step="0.1">
                    </div>
                </div>
                <div class="property-row">
                    <label for="xPosition">X Position:</label>
                    <input type="number" id="xPosition">
                </div>
                <div class="property-row">
                    <label for="yPosition">Y Position:</label>
                    <input type="number" id="yPosition">
                </div>
                <button id="updateProperties">Update</button>
            </div>
            <div id="reheatBoilerProperties" class="hidden">
                <div class="property-row">
                    <label for="reheat_p_out">Outlet Pressure (p_out):</label>
                    <input type="number" id="reheat_p_out" step="0.1">
                </div>
                <div class="property-row">
                    <label for="reheat_x_out">Dryness (x_out):</label>
                    <input type="number" id="reheat_x_out" min="0" max="1" step="0.1">
                </div>
                <div class="property-row">
                    <label for="reheat_t_out">Temperature (t_out):</label>
                    <input type="number" id="reheat_t_out" step="1">
                </div>
                <div class="property-row">
                    <label for="reheat_x_flow_out">Mass Flow (x_flow_out):</label>
                    <input type="number" id="reheat_x_flow_out" step="0.1">
                </div>
                <div class="property-row">
                    <label for="reheat_t_outRH">Reheat Temperature (t_ouletRH):</label>
                    <input type="number" id="reheat_t_outRH" step="1">
                </div>
                <div class="property-row">
                    <label for="reheat_p_outRH">Reheat Pressure (p_ouletRH):</label>
                    <input type="number" id="reheat_p_outRH" step="0.1">
                </div>
            </div>
            <!-- 通用位置属性 -->
            <div class="property-row">
                <label for="xPosition">X Position:</label>
                <input type="number" id="xPosition">
            </div>

            <div class="property-row">
                <label for="yPosition">Y Position:</label>
                <input type="number" id="yPosition">
            </div>

            <button id="updateProperties">Update</button>
        </div>
    </div>
</body>

</html>